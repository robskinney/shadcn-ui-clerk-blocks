{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "social-accounts-1",
  "type": "registry:block",
  "title": "Social Accounts - 1",
  "description": "A simple external account management card..",
  "dependencies": [
    "lucide-react",
    "sonner",
    "@clerk/nextjs",
    "@clerk/types"
  ],
  "registryDependencies": [
    "alert-dialog",
    "button",
    "card",
    "dropdown-menu",
    "spinner",
    "table",
    "skeleton"
  ],
  "files": [
    {
      "path": "registry/blocks/social-accounts/social-accounts-1/actions-dropdown.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { MoreHorizontalIcon } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { useAuth } from \"@clerk/nextjs\";\nimport { deleteSocialAccount } from \"./actions\";\nimport { UserResource } from \"@clerk/types\";\n\nexport function SocialAccountActionsDropdown({\n  accountId,\n  user,\n}: {\n  accountId: string;\n  user: UserResource;\n}) {\n  const { isSignedIn } = useAuth();\n  const [showRemoveDialog, setShowRemoveDialog] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  async function handleRemove() {\n    if (!isSignedIn) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        await deleteSocialAccount(accountId);\n        user.reload();\n        toast.success(\"Account removed successfully.\");\n      } catch (err) {\n        if (err instanceof Error) {\n          toast.error(err.message);\n        } else {\n          toast.error(\"An unknown error occured removing the social account.\");\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n  }\n\n  return (\n    <>\n      <DropdownMenu modal={false}>\n        <DropdownMenuTrigger asChild>\n          <Button variant=\"outline\" aria-label=\"Open menu\" size=\"icon-sm\">\n            <MoreHorizontalIcon />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent className=\"w-40\" align=\"end\">\n          <DropdownMenuLabel>Email Actions</DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuGroup>\n            <DropdownMenuItem\n              variant=\"destructive\"\n              onSelect={() => setShowRemoveDialog(true)}\n              disabled={accountId.startsWith(\"idn\")}\n            >\n              Remove account\n            </DropdownMenuItem>\n          </DropdownMenuGroup>\n        </DropdownMenuContent>\n      </DropdownMenu>\n      <AlertDialog open={showRemoveDialog} onOpenChange={setShowRemoveDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Remove this account?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This social account will no longer be associated with your account\n              immediately.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction asChild>\n              <Button onClick={handleRemove} disabled={loading}>\n                {loading ? (\n                  <>\n                    <Spinner />\n                    <p>Removing...</p>\n                  </>\n                ) : (\n                  \"Remove\"\n                )}\n              </Button>\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/social-accounts-1/actions-dropdown.tsx"
    },
    {
      "path": "registry/blocks/social-accounts/social-accounts-1/actions.ts",
      "content": "\"use server\";\n\nimport { isClerkAPIResponseError } from \"@clerk/nextjs/errors\";\nimport { auth, clerkClient } from \"@clerk/nextjs/server\";\nimport { revalidatePath } from \"next/cache\";\n\nexport async function deleteSocialAccount(externalAccountId: string) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"Failed to remove social account\");\n  }\n\n  const client = await clerkClient();\n\n  try {\n    await client.users.deleteUserExternalAccount({\n      userId,\n      externalAccountId,\n    });\n\n    revalidatePath(\"/\");\n    return { success: true };\n  } catch (err) {\n    if (isClerkAPIResponseError(err)) {\n      throw new Error(err.errors[0].longMessage);\n    } else {\n      throw new Error(\"An unknown error occured removing the social account.\");\n    }\n  }\n}\n",
      "type": "registry:file",
      "target": "components/social-accounts-1/actions.ts"
    },
    {
      "path": "registry/blocks/social-accounts/social-accounts-1/index.tsx",
      "content": "\"use client\";\n\nimport { Card, CardContent, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { getExternalAccount } from \"@/registry/lib/format-external-accounts\";\nimport { OAuthStrategy, SessionVerificationLevel } from \"@clerk/types\";\nimport { DotIcon } from \"lucide-react\";\nimport { SocialAccountActionsDropdown } from \"./actions-dropdown\";\nimport { useReverification, useUser } from \"@clerk/nextjs\";\nimport { useRouter } from \"next/navigation\";\nimport { toast } from \"sonner\";\nimport { useState } from \"react\";\nimport { VerificationComponent } from \"@/registry/blocks/verification-component\";\nimport {\n  isClerkRuntimeError,\n  isReverificationCancelledError,\n} from \"@clerk/nextjs/errors\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport type SocialAccounts1Props = {\n  /**\n   * A list of enabled Clerk [OAuthStrategy](https://clerk.com/docs/reference/javascript/types/sso#o-auth-strategy) strings.\n   * @example [\"oauth_google\", \"oauth_microsoft\"]\n   **/\n  enabledStrategies: OAuthStrategy[];\n  /**\n   * The URL to redirect to after successfully linking an account.\n   * @default \"/\"\n   **/\n  redirectUrl?: string;\n};\n\nexport default function SocialAccounts1({\n  enabledStrategies,\n  redirectUrl = \"/\",\n}: SocialAccounts1Props) {\n  const router = useRouter();\n\n  const { user, isLoaded } = useUser();\n\n  const [linkingProvider, setLinkingProvider] = useState<OAuthStrategy | null>(\n    null\n  );\n\n  const [verificationState, setVerificationState] = useState<\n    | {\n        complete: () => void;\n        cancel: () => void;\n        level: SessionVerificationLevel | undefined;\n        inProgress: boolean;\n      }\n    | undefined\n  >(undefined);\n\n  const createExternalAccount = useReverification(\n    (strategy: OAuthStrategy) =>\n      user?.createExternalAccount({\n        strategy,\n        redirectUrl: redirectUrl,\n      }),\n    {\n      onNeedsReverification: ({ complete, cancel, level }) => {\n        setVerificationState({\n          complete,\n          cancel,\n          level,\n          inProgress: true,\n        });\n      },\n    }\n  );\n\n  const handleLink = async (strategy: OAuthStrategy) => {\n    setLinkingProvider(strategy);\n    try {\n      await createExternalAccount(strategy).then((res) => {\n        if (res?.verification?.externalVerificationRedirectURL) {\n          router.push(res.verification.externalVerificationRedirectURL.href);\n        }\n      });\n    } catch (e) {\n      console.error(e);\n      if (isClerkRuntimeError(e) && isReverificationCancelledError(e)) {\n        toast.info(\"Verification cancelled.\");\n      } else {\n        toast.error(\"Failed to connect to OAuth Provider.\");\n      }\n    } finally {\n      setLinkingProvider(null);\n    }\n  };\n\n  return (\n    <>\n      <Card className=\"w-full p-3\">\n        <CardContent className=\"flex flex-col gap-y-4 p-5\">\n          <CardTitle className=\"flex flex-row\">\n            <h1>Social Accounts</h1>\n          </CardTitle>\n          <ScrollArea>\n            <Table className=\"mb-3\">\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Provider</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {enabledStrategies.map((providerKey) => {\n                  const providerInfo = getExternalAccount(providerKey);\n                  const Icon = providerInfo.icon;\n\n                  const userAccount = user?.externalAccounts?.find(\n                    (e) => e.provider === providerInfo.alias\n                  );\n\n                  const isLinked =\n                    userAccount?.verification?.status === \"verified\";\n\n                  return (\n                    <TableRow key={providerKey}>\n                      <TableCell>\n                        <div className=\"flex flex-row items-center h-full gap-2\">\n                          <Icon className=\"size-5\" />\n                          <div className=\"flex flex-row items-center gap-1\">\n                            <p>{providerInfo.name}</p>\n                            {isLoaded ? (\n                              isLinked && (\n                                <>\n                                  <DotIcon className=\"size-4 stroke-muted-foreground\" />\n                                  <p className=\"text-muted-foreground\">\n                                    {userAccount?.emailAddress}\n                                  </p>\n                                </>\n                              )\n                            ) : (\n                              <div className=\"pl-2\">\n                                <Skeleton className=\"h-5 w-40\" />\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </TableCell>\n\n                      <TableCell className=\"text-end\">\n                        {isLoaded && user ? (\n                          isLinked ? (\n                            <SocialAccountActionsDropdown\n                              accountId={userAccount.id!}\n                              user={user}\n                            />\n                          ) : (\n                            <Button\n                              disabled={!!linkingProvider}\n                              onClick={() => handleLink(providerInfo.key)}\n                              variant=\"outline\"\n                              size=\"sm\"\n                            >\n                              {linkingProvider === providerInfo.key ? (\n                                <>\n                                  <Spinner />\n                                  <p>Linking...</p>\n                                </>\n                              ) : (\n                                \"Link\"\n                              )}\n                            </Button>\n                          )\n                        ) : (\n                          <Skeleton className=\"size-8 rounded-md ml-auto\" />\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n            <ScrollBar orientation=\"horizontal\" />\n          </ScrollArea>\n        </CardContent>\n      </Card>\n      {verificationState?.inProgress && (\n        <VerificationComponent\n          level={verificationState?.level}\n          onComplete={() => {\n            verificationState.complete();\n            setVerificationState(undefined);\n          }}\n          onCancel={() => {\n            verificationState.cancel();\n            setVerificationState(undefined);\n          }}\n        />\n      )}\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/social-accounts-1/index.tsx"
    },
    {
      "path": "registry/blocks/verification-component.tsx",
      "content": "\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useSession } from \"@clerk/nextjs\";\nimport {\n  EmailCodeFactor,\n  SessionVerificationLevel,\n  SessionVerificationResource,\n} from \"@clerk/types\";\nimport {\n  AlertDialog,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  InputOTP,\n  InputOTPGroup,\n  InputOTPSlot,\n} from \"@/components/ui/input-otp\";\nimport z from \"zod\";\nimport { Controller, useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { toast } from \"sonner\";\nimport { Field, FieldError, FieldLabel } from \"@/components/ui/field\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { Button } from \"@/components/ui/button\";\nimport { REGEXP_ONLY_DIGITS } from \"input-otp\";\n\nconst verificationFormSchema = z.object({\n  code: z.string().min(6, {\n    message: \"Please enter your full one-time password.\",\n  }),\n});\n\nexport type VerificationFormValues = z.infer<typeof verificationFormSchema>;\n\nexport function VerificationComponent({\n  level = \"first_factor\",\n  onComplete,\n  onCancel,\n}: {\n  level: SessionVerificationLevel | undefined;\n  onComplete: () => void;\n  onCancel: () => void;\n}) {\n  const form = useForm<VerificationFormValues>({\n    resolver: zodResolver(verificationFormSchema),\n    defaultValues: {\n      code: \"\",\n    },\n  });\n\n  const { session } = useSession();\n  const [open, setOpen] = useState<boolean>(false);\n  const [loading, setLoading] = useState<boolean>(false);\n\n  const reverificationRef = useRef<SessionVerificationResource | undefined>(\n    undefined\n  );\n\n  const [determinedStartingFirstFactor, setDeterminedStartingFirstFactor] =\n    useState<EmailCodeFactor | undefined>();\n\n  useEffect(() => {\n    if (reverificationRef.current) {\n      return;\n    }\n\n    session?.startVerification({ level }).then(async (response) => {\n      reverificationRef.current = response;\n      await prepareEmailVerification(response);\n    });\n  }, []);\n\n  const prepareEmailVerification = async (\n    verificationResource: SessionVerificationResource\n  ) => {\n    // To simplify the example we will only handle the first factor verification\n    if (verificationResource.status === \"needs_first_factor\") {\n      // Determine the starting first factor from the supported first factors\n      const determinedStartingFirstFactor =\n        verificationResource.supportedFirstFactors?.filter(\n          (factor) => factor.strategy === \"email_code\"\n        )[0];\n\n      if (determinedStartingFirstFactor) {\n        setDeterminedStartingFirstFactor(determinedStartingFirstFactor);\n        // Prepare the first factor verification with the determined starting first factor\n        await session?.prepareFirstFactorVerification({\n          strategy: determinedStartingFirstFactor.strategy,\n          emailAddressId: determinedStartingFirstFactor?.emailAddressId,\n        });\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (determinedStartingFirstFactor) {\n      setOpen(true);\n    }\n  }, [determinedStartingFirstFactor]);\n\n  async function onSubmit(data: VerificationFormValues) {\n    setLoading(true);\n    try {\n      await session?.attemptFirstFactorVerification({\n        strategy: \"email_code\",\n        code: data.code,\n      });\n      onComplete();\n      toast.success(\"Session verified successfully.\");\n    } catch (e) {\n      console.error(e);\n      toast.error(\"An error occurred verifying session.\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (!determinedStartingFirstFactor) {\n    return null;\n  }\n\n  return (\n    <AlertDialog\n      open={open}\n      onOpenChange={(isOpen) => {\n        if (!isOpen) {\n          onCancel();\n        }\n        setOpen(isOpen);\n      }}\n    >\n      <AlertDialogContent>\n        <AlertDialogHeader className=\"gap-1\">\n          <AlertDialogTitle>Verify your Account</AlertDialogTitle>\n          <AlertDialogDescription>\n            Please enter the verification code sent to{\" \"}\n            {determinedStartingFirstFactor.safeIdentifier ||\n              \"your email address\"}\n            {\".\"}{\" \"}\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        {/* <input\n          type=\"number\"\n          name=\"code\"\n          onChange={(e) => setCode(e.target.value)}\n        /> */}\n        <form id=\"verify-email-1\" onSubmit={form.handleSubmit(onSubmit)}>\n          <Controller\n            name=\"code\"\n            control={form.control}\n            render={({ field, fieldState }) => (\n              <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                <FieldLabel htmlFor=\"form-email-add-1-email\">Code</FieldLabel>\n                {/* <FormControl> */}\n                <InputOTP maxLength={6} {...field} pattern={REGEXP_ONLY_DIGITS}>\n                  <InputOTPGroup>\n                    <InputOTPSlot index={0} />\n                    <InputOTPSlot index={1} />\n                    <InputOTPSlot index={2} />\n                    <InputOTPSlot index={3} />\n                    <InputOTPSlot index={4} />\n                    <InputOTPSlot index={5} />\n                  </InputOTPGroup>\n                </InputOTP>\n                {/* </FormConxtrol> */}\n\n                {fieldState.invalid && (\n                  <FieldError errors={[fieldState.error]} />\n                )}\n              </Field>\n            )}\n          />\n        </form>\n\n        <AlertDialogFooter>\n          <AlertDialogCancel onClick={() => onCancel()}>\n            Cancel\n          </AlertDialogCancel>\n          <Button disabled={loading} type=\"submit\" form=\"verify-email-1\">\n            {loading ? (\n              <>\n                <Spinner />\n                <p>Submitting...</p>\n              </>\n            ) : (\n              \"Submit\"\n            )}\n          </Button>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/lib/format-external-accounts.ts",
      "content": "import { OAuthProvider, OAuthStrategy } from \"@clerk/types\";\nimport {\n  FaGoogle,\n  FaMicrosoft,\n  FaGithub,\n  FaApple,\n  FaFacebook,\n  FaLinkedin,\n} from \"react-icons/fa\";\n\nexport type ExternalProviderInfo = {\n  key: OAuthStrategy;\n  alias: OAuthProvider;\n  name: string;\n  icon: React.ComponentType<{ className?: string }>;\n};\n\nexport const ExternalAccountsMap: Record<string, ExternalProviderInfo> = {\n  oauth_google: {\n    key: \"oauth_google\",\n    alias: \"google\",\n    name: \"Google\",\n    icon: FaGoogle,\n  },\n  oauth_microsoft: {\n    key: \"oauth_microsoft\",\n    alias: \"microsoft\",\n    name: \"Microsoft\",\n    icon: FaMicrosoft,\n  },\n  oauth_github: {\n    key: \"oauth_github\",\n    alias: \"github\",\n    name: \"GitHub\",\n    icon: FaGithub,\n  },\n  oauth_apple: {\n    key: \"oauth_apple\",\n    alias: \"apple\",\n    name: \"Apple\",\n    icon: FaApple,\n  },\n  oauth_facebook: {\n    key: \"oauth_facebook\",\n    alias: \"facebook\",\n    name: \"Facebook\",\n    icon: FaFacebook,\n  },\n  oauth_linkedin: {\n    key: \"oauth_linkedin\",\n    alias: \"linkedin\",\n    name: \"LinkedIn\",\n    icon: FaLinkedin,\n  },\n};\n\nexport function getExternalAccount(provider: string) {\n  const key = provider.startsWith(\"oauth_\") ? provider : `oauth_${provider}`;\n  return ExternalAccountsMap[key];\n}\n",
      "type": "registry:lib"
    }
  ]
}