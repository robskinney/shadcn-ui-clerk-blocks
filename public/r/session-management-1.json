{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "session-management-1",
  "type": "registry:block",
  "title": "Session Management - 1",
  "description": "A simple session management component.",
  "dependencies": [
    "lucide-react",
    "@clerk/nextjs",
    "date-fns"
  ],
  "registryDependencies": [
    "card",
    "scroll-area",
    "alert-dialog",
    "table",
    "badge",
    "button",
    "skeleton",
    "dropdown-menu",
    "sonner"
  ],
  "files": [
    {
      "path": "registry/blocks/session-management/session-management-1/actions.ts",
      "content": "\"use server\";\n\nimport { auth, clerkClient } from \"@clerk/nextjs/server\";\nimport { revalidatePath } from \"next/cache\";\n\nexport async function revokeSession(sessionId: string) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"Failed to revoke session\");\n  }\n\n  const client = await clerkClient();\n  await client.sessions.revokeSession(sessionId);\n\n  revalidatePath(\"/\");\n}\n",
      "type": "registry:component",
      "target": "components/session-management-1/actions.ts"
    },
    {
      "path": "registry/blocks/session-management/session-management-1/fetchers.ts",
      "content": "import { clerkClient, currentUser } from \"@clerk/nextjs/server\";\n\nexport async function fetchSessions() {\n  const user = await currentUser();\n\n  if (!user) {\n    throw new Error(\"Failed to retrieve session information.\");\n  }\n\n  const client = await clerkClient();\n\n  const sessions = (\n    await client.sessions.getSessionList({\n      userId: user.id,\n      status: \"active\",\n    })\n  ).data;\n\n  return sessions;\n}\n",
      "type": "registry:file",
      "target": "components/session-management-1/fetchers.ts"
    },
    {
      "path": "registry/blocks/session-management/session-management-1/index.tsx",
      "content": "import { Session } from \"@clerk/nextjs/server\";\nimport SessionManagement1Inner from \"./inner\";\nimport { formatSessions } from \"./utils\";\nimport { fetchSessions } from \"./fetchers\";\n\nexport type SessionManagement1Props = {\n  /**\n   * A Clerk [User](https://clerk.com/docs/reference/javascript/user) object retrieved from either the frontend or backend SDK.\n   **/\n  sessions?: Partial<Session>[];\n};\n\nexport default function SessionManagement1({\n  sessions,\n}: SessionManagement1Props) {\n  if (sessions) {\n    return <SessionManagement1Inner sessions={formatSessions(sessions)} />;\n  }\n\n  return <SessionManagement1WithClerk />;\n}\n\nasync function SessionManagement1WithClerk() {\n  const sessions = await fetchSessions();\n\n  if (!sessions || sessions.length === 0) return <p>No sessions found.</p>;\n\n  return <SessionManagement1Inner sessions={formatSessions(sessions)} />;\n}\n",
      "type": "registry:component",
      "target": "components/session-management-1/index.tsx"
    },
    {
      "path": "registry/blocks/session-management/session-management-1/inner.tsx",
      "content": "\"use client\";\n\nimport { Card, CardContent, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { formatTimestamp } from \"@/registry/lib/format-timestamp\";\nimport { SessionRevokeForm } from \"./session-revoke-form\";\nimport { IoLaptopOutline, IoPhonePortraitOutline } from \"react-icons/io5\";\nimport { FormattedSession } from \"./types\";\n\nexport default function SessionManagement1Inner({\n  sessions,\n}: {\n  sessions: FormattedSession[];\n}) {\n  return (\n    <Card className=\"w-full p-3\">\n      <CardContent className=\"flex flex-col gap-y-4 p-5\">\n        <CardTitle>Sessions</CardTitle>\n        <ScrollArea>\n          <Table className=\"mb-3\">\n            <TableHeader>\n              <TableRow>\n                <TableHead>Device</TableHead>\n                <TableHead>Detail</TableHead>\n                <TableHead>Last Seen</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {sessions.map((s) => (\n                <TableRow key={s.id}>\n                  <TableCell className=\"flex flex-row gap-2.5 items-center justify-between\">\n                    {s.isMobile == true ? (\n                      <IoPhonePortraitOutline className=\"size-8 stroke-muted-foreground\" />\n                    ) : (\n                      <IoLaptopOutline className=\"size-8 stroke-muted-foreground\" />\n                    )}\n\n                    <div className=\"flex flex-col w-full text-start font-medium gap-0.5\">\n                      <div className=\"flex flex-row w-full gap-1 items-center justify-start\">\n                        <p className=\"font-semibold\">{s.deviceType}</p>\n                        {s.status == \"active\" && (\n                          <Badge className=\"font-bold text-[0.6rem] bg-green-50 text-green-700 dark:bg-green-900/15 dark:text-green-400 dark:border-green-200/15\">\n                            Active\n                          </Badge>\n                        )}\n\n                        {/* {session && session.id == s.id && (\n                          <Badge variant=\"secondary\" className=\"text-[0.6rem]\">\n                            Current\n                          </Badge>\n                        )} */}\n                      </div>\n\n                      <p className=\"text-xs text-muted-foreground\">\n                        {s.browserName} {s.browserVersion}\n                      </p>\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"text-muted-foreground\">\n                    {`${s.ipAddress} (${s.city})`}\n                  </TableCell>\n                  <TableCell className=\"text-muted-foreground\">\n                    {formatTimestamp(s.updatedAt!)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <SessionRevokeForm sessionId={s.id} />\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n          <ScrollBar orientation=\"horizontal\" />\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/session-management-1/inner.tsx"
    },
    {
      "path": "registry/blocks/session-management/session-management-1/session-revoke-form.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { MoreHorizontalIcon } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { revokeSession } from \"./actions\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\nimport { useAuth, useSession } from \"@clerk/nextjs\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport function SessionRevokeForm({ sessionId }: { sessionId: string }) {\n  const { signOut } = useAuth();\n  const { session, isLoaded } = useSession();\n  const [showRevokeDialog, setShowRevokeDialog] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  async function handleRevoke() {\n    if (!session) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      try {\n        if (session.id === sessionId) {\n          signOut();\n        } else {\n          await revokeSession(sessionId);\n          toast.success(\"Session revoked successfully.\");\n        }\n      } catch (err) {\n        console.error(err);\n        toast.error(\"Failed to revoke session.\");\n      } finally {\n        setLoading(false);\n      }\n    }\n  }\n\n  return (\n    <>\n      <DropdownMenu modal={false}>\n        {isLoaded ? (\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"outline\" aria-label=\"Open menu\" size=\"icon-sm\">\n              <MoreHorizontalIcon />\n            </Button>\n          </DropdownMenuTrigger>\n        ) : (\n          <Skeleton className=\"size-8 rounded-md ml-auto\" />\n        )}\n\n        <DropdownMenuContent className=\"w-40\" align=\"end\">\n          <DropdownMenuLabel>Session Actions</DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuGroup>\n            <DropdownMenuItem\n              variant=\"destructive\"\n              onSelect={() => setShowRevokeDialog(true)}\n              disabled={!isLoaded}\n            >\n              {session && session.id === sessionId ? \"Log out\" : \"Revoke\"}\n            </DropdownMenuItem>\n          </DropdownMenuGroup>\n        </DropdownMenuContent>\n      </DropdownMenu>\n      <AlertDialog open={showRevokeDialog} onOpenChange={setShowRevokeDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              {session && session.id === sessionId\n                ? \"Sign out this device?\"\n                : \"Revoke this session?\"}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              This device will be logged out immediately.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction asChild>\n              <Button onClick={handleRevoke} disabled={loading}>\n                {loading\n                  ? session && session.id === sessionId\n                    ? \"Logging out...\"\n                    : \"Revoking...\"\n                  : \"Confirm\"}\n              </Button>\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/session-management-1/session-revoke-form.tsx"
    },
    {
      "path": "registry/blocks/session-management/session-management-1/types.ts",
      "content": "export type FormattedSession = {\n  id: string;\n  isMobile?: boolean;\n  deviceType?: string;\n  status: string;\n  browserName?: string;\n  browserVersion?: string;\n  ipAddress?: string;\n  city: string;\n  updatedAt: number;\n};\n",
      "type": "registry:file",
      "target": "components/session-management-1/types.ts"
    },
    {
      "path": "registry/blocks/session-management/session-management-1/utils.ts",
      "content": "import { Session } from \"@clerk/nextjs/server\";\nimport { FormattedSession } from \"./types\";\n\nexport function formatSessions(sessions: Partial<Session>[]) {\n  return sessions.map((session) => ({\n    id: session.id,\n    isMobile: session.latestActivity?.isMobile,\n    deviceType: session.latestActivity?.deviceType,\n    status: session.status,\n    browserName: session.latestActivity?.browserName,\n    browserVersion: session.latestActivity?.browserVersion,\n    ipAddress: session.latestActivity?.ipAddress,\n    city: session.latestActivity?.city,\n    updatedAt: session.updatedAt,\n  })) as FormattedSession[];\n}\n",
      "type": "registry:file",
      "target": "components/session-management-1/utils.ts"
    },
    {
      "path": "registry/lib/format-timestamp.ts",
      "content": "import { format, isToday, isYesterday } from \"date-fns\";\n\nexport function formatTimestamp(ts: number) {\n  const date = new Date(ts);\n  if (isToday(date)) return `Today at ${format(date, \"h:mm a\")}`;\n  if (isYesterday(date)) return `Yesterday at ${format(date, \"h:mm a\")}`;\n  return format(date, \"MMM d, yyyy 'at' h:mm a\");\n}\n",
      "type": "registry:lib"
    }
  ]
}