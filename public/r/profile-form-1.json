{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "profile-form-1",
  "type": "registry:block",
  "title": "Profile Form - 1",
  "description": "A simple profile form.",
  "dependencies": [
    "zod",
    "react-hook-form",
    "@hookform/resolvers",
    "browser-image-compression",
    "@clerk/types",
    "@clerk/nextjs"
  ],
  "registryDependencies": [
    "card",
    "input",
    "avatar",
    "skeleton",
    "button",
    "sonner",
    "field",
    "spinner"
  ],
  "files": [
    {
      "path": "registry/blocks/profile-form/profile-form-1/index.tsx",
      "content": "\"use client\";\n\nimport { Upload } from \"lucide-react\";\n\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport imageCompression from \"browser-image-compression\";\nimport { useAuth, useUser } from \"@clerk/nextjs\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport { UserResource } from \"@clerk/types\";\nimport { User } from \"@clerk/nextjs/server\";\nimport z from \"zod\";\nimport { Controller, useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useState } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n  Field,\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport { updateUserProfile } from \"./actions\";\nimport { Spinner } from \"@/components/ui/spinner\";\n\ntype ProfileForm1Props = {\n  user?: Partial<UserResource> | Partial<User> | null;\n};\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 1MB\nconst ACCEPTED_IMAGE_TYPES = [\n  \"image/jpeg\",\n  \"image/jpg\",\n  \"image/png\",\n  \"image/webp\",\n];\n\nconst userProfileUpdateFormSchema = z.object({\n  picture: z\n    .file()\n    .min(1)\n    .max(MAX_FILE_SIZE, \"Image must be less than 5MB.\")\n    .mime(ACCEPTED_IMAGE_TYPES, \"Image must be .jpeg, .jpg, .png, or .webp.\")\n    .optional(),\n  firstName: z.string(),\n  lastName: z.string(),\n});\n\nexport type UserProfileUpdateFormValues = z.infer<\n  typeof userProfileUpdateFormSchema\n>;\n\nexport default function ProfileForm1({ user }: ProfileForm1Props) {\n  if (user) {\n    return <ProfileForm1Inner user={user} />;\n  }\n\n  return <ProfileForm1WithClerk />;\n}\n\nfunction ProfileForm1WithClerk() {\n  const { user, isLoaded, isSignedIn } = useUser();\n\n  if (!isLoaded) return <Skeleton className=\"w-20\" />;\n  if (!isSignedIn || !user)\n    return (\n      <p className=\"text-primary dark:text-secondary-foreground\">Sign in</p>\n    );\n\n  return <ProfileForm1Inner user={user} />;\n}\n\nfunction ProfileForm1Inner({\n  user,\n}: {\n  user: Partial<UserResource> | Partial<User>;\n}) {\n  const { isSignedIn } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(\n    user.imageUrl ?? null\n  );\n\n  const form = useForm<z.infer<typeof userProfileUpdateFormSchema>>({\n    resolver: zodResolver(userProfileUpdateFormSchema),\n    defaultValues: {\n      picture: undefined,\n      firstName: user.firstName ?? \"\",\n      lastName: user.lastName ?? \"\",\n    },\n  });\n\n  async function handleUpdate(data: UserProfileUpdateFormValues) {\n    if (!isSignedIn) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        const processedData = { ...data };\n\n        if (data.picture) {\n          const compressedFile = await imageCompression(data.picture, {\n            maxSizeMB: 1,\n            maxWidthOrHeight: 1024,\n            useWebWorker: true,\n          });\n\n          processedData.picture = compressedFile;\n        }\n\n        await updateUserProfile(processedData);\n        toast.success(\"Profile updated successfully\");\n      } catch (err) {\n        console.error(err);\n        toast.error(\"Failed to update profile\");\n      } finally {\n        setLoading(false);\n      }\n    }\n  }\n\n  function onSubmit(data: UserProfileUpdateFormValues) {\n    handleUpdate(data);\n  }\n\n  return (\n    <Card className=\"w-full sm:w-96 p-3\">\n      <CardContent>\n        <form\n          id=\"form-profile-update-1\"\n          className=\"flex flex-col gap-y-8 p-5\"\n          onSubmit={form.handleSubmit(onSubmit)}\n        >\n          <div className=\"flex flex-col sm:flex-row items-center gap-4\">\n            <Avatar className=\"aspect-square size-24 rounded-full bg-slate-400\">\n              <AvatarImage\n                src={previewUrl ?? user.imageUrl ?? undefined}\n                className=\"object-cover\"\n                alt=\"User profile picture\"\n              />\n              <AvatarFallback className=\"outline-1 outline-primary bg-linear-to-tr from-pink-300 to-primary/75\" />\n            </Avatar>\n            <div className=\"gap-2\">\n              <Controller\n                name=\"picture\"\n                control={form.control}\n                render={({\n                  field: { value, onChange, ...fieldProps },\n                  fieldState,\n                }) => (\n                  <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                    <input\n                      type=\"file\"\n                      accept=\"image/*\"\n                      className=\"hidden\"\n                      id=\"form-profile-update-1-picture\"\n                      {...fieldProps}\n                      onChange={(event) => {\n                        const file = event.target.files?.[0];\n                        if (file) {\n                          onChange(file);\n                          const objectUrl = URL.createObjectURL(file);\n                          setPreviewUrl(objectUrl);\n                        }\n                      }}\n                    />\n\n                    <label htmlFor=\"form-profile-update-1-picture\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"w-full\"\n                        asChild\n                      >\n                        <span className=\"flex items-center gap-2\">\n                          <Upload />\n                          Replace Image\n                        </span>\n                      </Button>\n                    </label>\n\n                    <FieldDescription className=\"text-center sm:text-start text-xs\">\n                      Recommend size 1:1, up to 1MB\n                    </FieldDescription>\n\n                    {fieldState.invalid && (\n                      <FieldError errors={[fieldState.error]} />\n                    )}\n                  </Field>\n                )}\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n            <Controller\n              name=\"firstName\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-profile-update-1-firstName\">\n                    First Name\n                  </FieldLabel>\n                  <Input\n                    {...field}\n                    id=\"form-profile-update-1-firstName\"\n                    aria-invalid={fieldState.invalid}\n                    placeholder=\"Robert\"\n                    autoComplete=\"given-name\"\n                  />\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n            <Controller\n              name=\"lastName\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-profile-update-1-firstName\">\n                    First Name\n                  </FieldLabel>\n                  <Input\n                    {...field}\n                    id=\"form-profile-update-1-firstName\"\n                    aria-invalid={fieldState.invalid}\n                    placeholder=\"Kinney\"\n                    autoComplete=\"family-name\"\n                  />\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n          </div>\n\n          <Button type=\"submit\" disabled={loading}>\n            {loading ? (\n              <>\n                <Spinner />\n                <p>Saving...</p>\n              </>\n            ) : (\n              \"Save Changes\"\n            )}\n          </Button>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/profile-form-1/index.tsx"
    },
    {
      "path": "registry/blocks/profile-form/profile-form-1/actions.ts",
      "content": "\"use server\";\n\nimport { UserProfileUpdateFormValues } from \"./index\";\nimport { auth, clerkClient } from \"@clerk/nextjs/server\";\n\nexport async function updateUserProfile(data: UserProfileUpdateFormValues) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"Failed to remove email\");\n  }\n\n  const client = await clerkClient();\n\n  await client.users.updateUser(userId, {\n    firstName: data.firstName,\n    lastName: data.lastName,\n  });\n\n  if (data.picture && data.picture.size > 0) {\n    await client.users.updateUserProfileImage(userId, { file: data.picture });\n  }\n}\n",
      "type": "registry:component",
      "target": "components/profile-form-1/actions.ts"
    }
  ]
}