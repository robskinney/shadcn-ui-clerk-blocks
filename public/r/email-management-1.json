{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "email-management-1",
  "type": "registry:block",
  "title": "Email Management - 1",
  "description": "A simple email management component.",
  "dependencies": [
    "zod",
    "react-hook-form",
    "@hookform/resolvers",
    "lucide-react",
    "@clerk/nextjs",
    "@clerk/backend",
    "sonner"
  ],
  "registryDependencies": [
    "card",
    "scroll-area",
    "tooltip",
    "field",
    "alert-dialog",
    "dialog",
    "input",
    "checkbox",
    "table",
    "badge",
    "button",
    "dropdown-menu",
    "sonner",
    "skeleton"
  ],
  "files": [
    {
      "path": "registry/blocks/email-management/email-management-1/actions.ts",
      "content": "\"use server\";\n\nimport { isClerkAPIResponseError } from \"@clerk/nextjs/errors\";\nimport { OrganizationCreateFormValues } from \"./email-add-form\";\nimport { auth, clerkClient } from \"@clerk/nextjs/server\";\nimport { revalidatePath } from \"next/cache\";\n\nexport async function createEmailAddress(data: OrganizationCreateFormValues) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"You must be authenticated to create an email.\");\n  }\n\n  const client = await clerkClient();\n\n  try {\n    const res = await client.emailAddresses.createEmailAddress({\n      userId,\n      emailAddress: data.email,\n      primary: data.isPrimary,\n    });\n\n    return {\n      id: res.id,\n      emailAddress: res.emailAddress,\n      isPrimary: data.isPrimary,\n      isVerified: false,\n    };\n  } catch (err) {\n    if (isClerkAPIResponseError(err)) {\n      throw new Error(err.errors[0].longMessage);\n    } else {\n      throw new Error(\"An unknown error occured creating the email.\");\n    }\n  }\n}\n\nexport async function deleteEmailAddress(emailAddressId: string) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"You must be authenticated to remove an email.\");\n  }\n\n  const client = await clerkClient();\n\n  try {\n    await client.emailAddresses.deleteEmailAddress(emailAddressId);\n\n    revalidatePath(\"/\");\n    return { success: true };\n  } catch (err) {\n    if (isClerkAPIResponseError(err)) {\n      throw new Error(err.errors[0].longMessage);\n    } else {\n      throw new Error(\"An unknown error occured removing the email.\");\n    }\n  }\n}\n\nexport async function setEmailPrimary(emailAddressId: string) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"Failed to remove email\");\n  }\n\n  const client = await clerkClient();\n\n  try {\n    await client.users.updateUser(userId, {\n      primaryEmailAddressID: emailAddressId,\n    });\n\n    revalidatePath(\"/\");\n    return { success: true };\n  } catch (err) {\n    if (isClerkAPIResponseError(err)) {\n      throw new Error(err.errors[0].longMessage);\n    } else {\n      throw new Error(\"An unknown error occured removing the email.\");\n    }\n  }\n}\n",
      "type": "registry:component",
      "target": "components/email-management-1/actions.ts"
    },
    {
      "path": "registry/blocks/email-management/email-management-1/email-actions-dropdown.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { MoreHorizontalIcon } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { toast } from \"sonner\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { deleteEmailAddress, setEmailPrimary } from \"./actions\";\nimport { FormattedEmailAddress } from \"./types\";\n\nexport function EmailActionsDropdown({\n  emailId,\n  isPrimary,\n  isLinked,\n  setEmails,\n}: {\n  emailId: string;\n  isPrimary: boolean;\n  isLinked: boolean;\n  setEmails: React.Dispatch<React.SetStateAction<FormattedEmailAddress[]>>;\n}) {\n  const { user } = useUser();\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const [showRemoveDialog, setShowRemoveDialog] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  async function handleRemove() {\n    if (!user) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        await deleteEmailAddress(emailId);\n        setEmails((prev) =>\n          prev.filter((e) => (e.id === emailId ? false : true))\n        );\n\n        toast.success(\"Email removed successfully.\");\n        setShowRemoveDialog(false);\n      } catch (err) {\n        if (err instanceof Error) {\n          toast.error(err.message);\n        } else {\n          toast.error(\"An unknown error occured removing the email.\");\n        }\n      } finally {\n        // handleRefresh();\n        setLoading(false);\n      }\n    }\n  }\n\n  async function handleSetPrimary() {\n    if (!user) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        await setEmailPrimary(emailId);\n        setEmails((prev) =>\n          prev.map((e) =>\n            e.id === emailId\n              ? { ...e, isPrimary: true }\n              : { ...e, isPrimary: false }\n          )\n        );\n\n        toast.success(\"Email updated successfully.\");\n      } catch (err) {\n        if (err instanceof Error) {\n          toast.error(err.message);\n        } else {\n          toast.error(\"An unknown error occured updating the email.\");\n        }\n      } finally {\n        // handleRefresh();\n        setLoading(false);\n      }\n    }\n  }\n\n  return (\n    <>\n      <DropdownMenu\n        modal={false}\n        open={dropdownOpen}\n        onOpenChange={setDropdownOpen}\n      >\n        <DropdownMenuTrigger asChild>\n          <Button variant=\"outline\" aria-label=\"Open menu\" size=\"icon-sm\">\n            <MoreHorizontalIcon />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent className=\"w-40\" align=\"end\">\n          <DropdownMenuLabel>Email Actions</DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuGroup>\n            <DropdownMenuItem\n              onClick={() => handleSetPrimary()}\n              disabled={isPrimary}\n            >\n              Set as primary\n            </DropdownMenuItem>\n            <DropdownMenuItem\n              variant=\"destructive\"\n              disabled={isPrimary || isLinked}\n              onClick={() => setShowRemoveDialog(true)}\n            >\n              Remove email\n            </DropdownMenuItem>\n          </DropdownMenuGroup>\n        </DropdownMenuContent>\n      </DropdownMenu>\n      <AlertDialog open={showRemoveDialog} onOpenChange={setShowRemoveDialog}>\n        <AlertDialogContent aria-describedby=\"A popup requesting confirmation on removal of an email address.\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Remove this email address?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This email address will no longer be associated with your account\n              immediately.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction asChild>\n              <Button onClick={handleRemove} disabled={loading}>\n                {loading ? (\n                  <>\n                    <Spinner />\n                    <p>Removing...</p>\n                  </>\n                ) : (\n                  \"Remove\"\n                )}\n              </Button>\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/email-management-1/email-actions-dropdown.tsx"
    },
    {
      "path": "registry/blocks/email-management/email-management-1/email-add-form.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Controller, useForm } from \"react-hook-form\";\nimport * as z from \"zod\";\nimport { Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Field,\n  FieldError,\n  FieldGroup,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport { toast } from \"sonner\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogClose,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { createEmailAddress } from \"./actions\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { FormattedEmailAddress } from \"./types\";\n\nconst emailAddFormSchema = z.object({\n  email: z.email(),\n  isPrimary: z.boolean(),\n});\n\nexport type OrganizationCreateFormValues = z.infer<typeof emailAddFormSchema>;\n\nexport function EmailAddForm({\n  setEmails,\n}: {\n  setEmails: React.Dispatch<React.SetStateAction<FormattedEmailAddress[]>>;\n}) {\n  const { user } = useUser();\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const form = useForm<z.infer<typeof emailAddFormSchema>>({\n    resolver: zodResolver(emailAddFormSchema),\n    defaultValues: {\n      email: \"\",\n      isPrimary: false,\n    },\n  });\n\n  async function handleAdd(data: OrganizationCreateFormValues) {\n    if (!user) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        const newEmail = await createEmailAddress(data);\n        setEmails((prev) => [\n          ...prev,\n          {\n            id: newEmail.id,\n            emailAddress: newEmail.emailAddress,\n            isPrimary: data.isPrimary,\n            isVerified: false,\n          },\n        ]);\n\n        toast.success(\"Email created successfully.\");\n        setShowAddDialog(false);\n      } catch (err) {\n        if (err instanceof Error) {\n          toast.error(err.message);\n        } else {\n          toast.error(\"An unknown error occured creating the email.\");\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n  }\n\n  function onSubmit(data: OrganizationCreateFormValues) {\n    handleAdd(data);\n  }\n\n  return (\n    <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\">\n          <Plus />\n          Add email\n        </Button>\n      </DialogTrigger>\n      <DialogContent\n        className=\"sm:max-w-[425px]\"\n        aria-describedby=\"A popup form requesting information on an email address to add.\"\n      >\n        <DialogHeader>\n          <DialogTitle>Add a new email address</DialogTitle>\n        </DialogHeader>\n        <form id=\"form-email-add-1\" onSubmit={form.handleSubmit(onSubmit)}>\n          <FieldGroup className=\"gap-4\">\n            <Controller\n              name=\"email\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-email-add-1-email\">\n                    Email\n                  </FieldLabel>\n                  <Input\n                    {...field}\n                    id=\"form-email-add-1-email\"\n                    aria-invalid={fieldState.invalid}\n                    placeholder=\"robertskinney@outlook.com\"\n                    type=\"email\"\n                    autoComplete=\"email\"\n                  />\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n            <Controller\n              name=\"isPrimary\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field\n                  data-invalid={fieldState.invalid}\n                  orientation=\"horizontal\"\n                >\n                  <Checkbox\n                    id=\"form-email-add-1-isPrimary\"\n                    name={field.name}\n                    checked={field.value}\n                    onCheckedChange={field.onChange}\n                  />\n                  <FieldLabel\n                    htmlFor=\"form-email-add-1-isPrimary\"\n                    className=\"font-normal\"\n                  >\n                    Is Primary\n                  </FieldLabel>\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n          </FieldGroup>\n        </form>\n\n        <DialogFooter>\n          <DialogClose asChild>\n            <Button variant=\"outline\">Cancel</Button>\n          </DialogClose>\n          <Button type=\"submit\" form=\"form-email-add-1\" disabled={loading}>\n            {loading ? (\n              <>\n                <Spinner />\n                <p>Adding...</p>\n              </>\n            ) : (\n              \"Add Email\"\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/email-management-1/email-add-form.tsx"
    },
    {
      "path": "registry/blocks/email-management/email-management-1/index.tsx",
      "content": "\"use client\";\n\nimport { Card, CardContent, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Mail, TriangleAlert, Verified } from \"lucide-react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { EmailAddForm } from \"./email-add-form\";\nimport { EmailActionsDropdown } from \"./email-actions-dropdown\";\nimport { IdentificationLinkJSON, UserResource } from \"@clerk/types\";\nimport { getExternalAccount } from \"@/registry/lib/format-external-accounts\";\nimport { User } from \"@clerk/backend\";\nimport { formatUserEmails } from \"./utils\";\nimport { useUser } from \"@clerk/nextjs\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useEffect, useState } from \"react\";\nimport { FormattedEmailAddress } from \"./types\";\n\nexport type EmailManagement1Props = {\n  /**\n   * A Clerk [User](https://clerk.com/docs/reference/javascript/user) object retrieved from either the frontend or backend SDK.\n   **/\n  user?: Partial<UserResource> | Partial<User>;\n};\n\nexport default function EmailManagement1({\n  user: propUser,\n}: EmailManagement1Props) {\n  const { user: hookUser, isLoaded } = !propUser\n    ? useUser()\n    : { user: null, isLoaded: true };\n\n  const user = propUser || hookUser;\n\n  const [emails, setEmails] = useState<FormattedEmailAddress[]>([]);\n\n  useEffect(() => {\n    if (user && isLoaded) {\n      setEmails(formatUserEmails(user));\n    }\n  }, [user, isLoaded]);\n\n  return (\n    <Card className=\"w-full p-3 transition-all duration-300 ease-out\">\n      <CardContent className=\"flex flex-col gap-y-4 p-5\">\n        <CardTitle className=\"flex flex-row justify-between items-center gap-3\">\n          <h1>Email Addresses</h1>\n          <EmailAddForm setEmails={setEmails} />\n        </CardTitle>\n        <ScrollArea>\n          <Table className=\"mb-3\">\n            <TableHeader>\n              <TableRow>\n                <TableHead>Address</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {isLoaded ? (\n                emails.map((e) => (\n                  <TableRow key={e.id}>\n                    <TableCell>\n                      <div className=\"flex flex-row items-center h-full gap-2\">\n                        <Mail className=\"size-4 stroke-muted-foreground\" />\n\n                        <p>{e.emailAddress}</p>\n\n                        {e.isVerified ? (\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Verified className=\"size-4 stroke-green-700 dark:stroke-green-400\" />\n                            </TooltipTrigger>\n                            <TooltipContent>\n                              This email address is verified.\n                            </TooltipContent>\n                          </Tooltip>\n                        ) : (\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <TriangleAlert className=\"size-4 stroke-orange-400 dark:stroke-orange-400\" />\n                            </TooltipTrigger>\n                            <TooltipContent>\n                              This email address is not verified.\n                            </TooltipContent>\n                          </Tooltip>\n                        )}\n\n                        {e.isPrimary && (\n                          <Badge className=\"font-bold text-[0.6rem] bg-green-50 text-green-700 dark:bg-green-900/15 dark:text-green-400 dark:border-green-200/15\">\n                            Primary\n                          </Badge>\n                        )}\n\n                        {e.linkedTo && e.linkedTo.length > 0 && (\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Badge\n                                variant=\"secondary\"\n                                className=\"text-[0.6rem]\"\n                              >\n                                Linked\n                              </Badge>\n                            </TooltipTrigger>\n                            <TooltipContent>\n                              {`Linked via ${e.linkedTo\n                                ?.map(\n                                  (l: IdentificationLinkJSON) =>\n                                    getExternalAccount(l.type).name\n                                )\n                                .filter(Boolean)\n                                .join(\", \")}`}\n                            </TooltipContent>\n                          </Tooltip>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <EmailActionsDropdown\n                        emailId={e.id!}\n                        isPrimary={e.isPrimary!}\n                        isLinked={!!(e.linkedTo && e.linkedTo.length)}\n                        setEmails={setEmails}\n                      />\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell>\n                    <div className=\"flex flex-row items-center h-full gap-2\">\n                      <Mail className=\"size-4 stroke-muted-foreground\" />\n\n                      <Skeleton className=\"h-5 w-36\" />\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <Skeleton className=\"size-8 rounded-md ml-auto\" />\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n          <ScrollBar orientation=\"horizontal\" />\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/email-management-1/index.tsx"
    },
    {
      "path": "registry/blocks/email-management/email-management-1/types.ts",
      "content": "import { IdentificationLinkJSON } from \"@clerk/types\";\n\nexport type FormattedEmailAddress = {\n  id: string;\n  emailAddress: string;\n  isVerified: boolean;\n  isPrimary: boolean;\n  linkedTo?: IdentificationLinkJSON[];\n};\n",
      "type": "registry:component",
      "target": "components/email-management-1/types.ts"
    },
    {
      "path": "registry/blocks/email-management/email-management-1/utils.ts",
      "content": "import { User } from \"@clerk/nextjs/server\";\nimport { FormattedEmailAddress } from \"./types\";\nimport { UserResource } from \"@clerk/types\";\n\nexport function formatUserEmails(user?: Partial<UserResource> | Partial<User>) {\n  if (!user || !user.emailAddresses) return [];\n\n  const primaryEmailId = user.primaryEmailAddressId;\n\n  const emails = user.emailAddresses.map((email) => {\n    const linkedTo = email.linkedTo.map((link) => ({\n      id: link.id,\n      type: link.type,\n    }));\n\n    return {\n      id: email.id,\n      emailAddress: email.emailAddress,\n      isVerified: email.verification?.status === \"verified\",\n      isPrimary: email.id === primaryEmailId,\n      linkedTo,\n    };\n  });\n\n  return emails as FormattedEmailAddress[];\n}\n",
      "type": "registry:component",
      "target": "components/email-management-1/utils.ts"
    },
    {
      "path": "registry/lib/format-external-accounts.ts",
      "content": "import { OAuthProvider, OAuthStrategy } from \"@clerk/types\";\nimport {\n  FaGoogle,\n  FaMicrosoft,\n  FaGithub,\n  FaApple,\n  FaFacebook,\n  FaLinkedin,\n} from \"react-icons/fa\";\n\nexport type ExternalProviderInfo = {\n  key: OAuthStrategy;\n  alias: OAuthProvider;\n  name: string;\n  icon: React.ComponentType<{ className?: string }>;\n};\n\nexport const ExternalAccountsMap: Record<string, ExternalProviderInfo> = {\n  oauth_google: {\n    key: \"oauth_google\",\n    alias: \"google\",\n    name: \"Google\",\n    icon: FaGoogle,\n  },\n  oauth_microsoft: {\n    key: \"oauth_microsoft\",\n    alias: \"microsoft\",\n    name: \"Microsoft\",\n    icon: FaMicrosoft,\n  },\n  oauth_github: {\n    key: \"oauth_github\",\n    alias: \"github\",\n    name: \"GitHub\",\n    icon: FaGithub,\n  },\n  oauth_apple: {\n    key: \"oauth_apple\",\n    alias: \"apple\",\n    name: \"Apple\",\n    icon: FaApple,\n  },\n  oauth_facebook: {\n    key: \"oauth_facebook\",\n    alias: \"facebook\",\n    name: \"Facebook\",\n    icon: FaFacebook,\n  },\n  oauth_linkedin: {\n    key: \"oauth_linkedin\",\n    alias: \"linkedin\",\n    name: \"LinkedIn\",\n    icon: FaLinkedin,\n  },\n};\n\nexport function getExternalAccount(provider: string) {\n  const key = provider.startsWith(\"oauth_\") ? provider : `oauth_${provider}`;\n  return ExternalAccountsMap[key];\n}\n",
      "type": "registry:lib"
    }
  ]
}