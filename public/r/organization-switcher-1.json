{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "organization-switcher-1",
  "type": "registry:block",
  "title": "Organization Switcher - 1",
  "description": "A simple organization switcher component.",
  "dependencies": [
    "@clerk/nextjs",
    "@clerk/types",
    "lucide-react"
  ],
  "registryDependencies": [
    "avatar",
    "dropdown-menu",
    "skeleton",
    "button",
    "field",
    "dialog"
  ],
  "files": [
    {
      "path": "registry/blocks/organization-switcher/organization-switcher-1/actions.ts",
      "content": "\"use server\";\n\nimport { auth, clerkClient } from \"@clerk/nextjs/server\";\n\ntype UpdateLogoParams = {\n  file: Blob | File;\n  uploaderUserId?: string;\n};\n\nexport async function updateOrganizationPicture(\n  orgId: string,\n  params: UpdateLogoParams\n) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"Failed to update organization picture.\");\n  }\n\n  const client = await clerkClient();\n\n  await client.organizations.updateOrganizationLogo(orgId, params);\n}\n",
      "type": "registry:file",
      "target": "components/organization-switcher-1/actions.ts"
    },
    {
      "path": "registry/blocks/organization-switcher/organization-switcher-1/index.tsx",
      "content": "\"use client\";\n\nimport { Building, Check, ChevronsUpDown, Plus } from \"lucide-react\";\n\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useAuth, useOrganization, useOrganizationList } from \"@clerk/nextjs\";\nimport { Button } from \"@/components/ui/button\";\nimport { DropdownMenuContentProps } from \"@radix-ui/react-dropdown-menu\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { cn } from \"@/lib/utils\";\nimport { OrganizationCreateForm } from \"./organization-add-form\";\n\nexport type OrganizationSwitcher1Props = {\n  /**\n   * [DropdownMenuContent](https://www.radix-ui.com/primitives/docs/components/dropdown-menu#content)\n   * props that drill down to the content of the UserDropdown.\n   * @default {side: \"bottom\", align: \"end\", sideOffset: 8}\n   **/\n  dropdownMenuContentProps?: DropdownMenuContentProps;\n};\n\nexport default function OrganizationSwitcher1({\n  dropdownMenuContentProps = { side: \"bottom\", align: \"end\", sideOffset: 8 },\n}: OrganizationSwitcher1Props) {\n  const { isSignedIn } = useAuth();\n  const { organization, isLoaded: isOrganizationLoaded } = useOrganization();\n\n  const {\n    userMemberships,\n    setActive,\n    createOrganization,\n    isLoaded: isOrganizationListLoaded,\n  } = useOrganizationList({\n    userMemberships: {\n      infinite: true,\n    },\n  });\n\n  return (\n    <>\n      <DropdownMenu modal={false}>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant=\"outline\"\n            className=\"flex flex-row items-center gap-2 p-2 w-full max-w-64 h-12 transition-all duration-100 hover:shadow-md\"\n          >\n            {isOrganizationLoaded ? (\n              <Avatar className=\"aspect-square size-8 rounded-full bg-slate-400\">\n                <AvatarImage\n                  src={organization?.imageUrl}\n                  className=\"object-cover\"\n                  alt=\"User profile picture\"\n                />\n                <AvatarFallback>\n                  <Building />\n                </AvatarFallback>\n              </Avatar>\n            ) : (\n              <Skeleton className={`size-8 rounded-full`} />\n            )}\n\n            <div className=\"grid flex-1 text-left text-sm leading-tight\">\n              <span className=\"truncate font-semibold\">\n                {!isOrganizationLoaded ? (\n                  <Skeleton className=\"w-24 h-4\" />\n                ) : organization ? (\n                  organization.name\n                ) : (\n                  <p>Organization</p>\n                )}\n              </span>\n              <span className=\"truncate text-xs text-muted-foreground\">\n                {!isOrganizationLoaded ? (\n                  <Skeleton className=\"w-24 h-4\" />\n                ) : organization ? (\n                  organization.slug\n                ) : (\n                  <p>No organization selected.</p>\n                )}\n              </span>\n            </div>\n            <ChevronsUpDown className=\"ml-auto size-4\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent\n          className=\"w-(--radix-dropdown-menu-trigger-width) rounded-lg\"\n          {...dropdownMenuContentProps}\n        >\n          <DropdownMenuLabel className=\"text-xs text-muted-foreground\">\n            Organizations\n          </DropdownMenuLabel>\n\n          {!isSignedIn ? (\n            <DropdownMenuItem disabled>\n              You must be authenticated to change organizations.\n            </DropdownMenuItem>\n          ) : !isOrganizationListLoaded ? (\n            <DropdownMenuItem disabled>\n              <Spinner />\n            </DropdownMenuItem>\n          ) : userMemberships ? (\n            userMemberships.data?.map((mem) => (\n              <DropdownMenuItem\n                key={mem.organization.id}\n                disabled={mem.organization.id === organization?.id}\n                onClick={async () => {\n                  setActive({ organization: mem.organization.id });\n                }}\n              >\n                <Avatar className=\"aspect-square size-8 rounded-full bg-slate-400\">\n                  <AvatarImage\n                    src={mem.organization.imageUrl}\n                    className=\"object-cover\"\n                    alt=\"User profile picture\"\n                  />\n                  <AvatarFallback>\n                    <Building />\n                  </AvatarFallback>\n                </Avatar>\n                <p className=\"font-semibold\">{mem.organization.name}</p>\n\n                <Check\n                  className={cn(\n                    \"ml-auto\",\n                    mem.organization.id === organization?.id\n                      ? \"opacity-100\"\n                      : \"opacity-0\"\n                  )}\n                />\n              </DropdownMenuItem>\n            ))\n          ) : (\n            <DropdownMenuItem disabled>No organizations.</DropdownMenuItem>\n          )}\n\n          <DropdownMenuSeparator />\n\n          <OrganizationCreateForm\n            createOrganization={createOrganization!}\n            setActive={setActive!}\n            revalidate={userMemberships.revalidate!}\n          >\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start items-center gap-2 p-2\"\n              disabled={!isOrganizationListLoaded}\n            >\n              <div className=\"flex size-6 items-center justify-center rounded-md border bg-background\">\n                <Plus className=\"size-4\" />\n              </div>\n              <div className=\"font-medium text-muted-foreground\">\n                Create Organization\n              </div>\n            </Button>\n          </OrganizationCreateForm>\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/organization-switcher-1/index.tsx"
    },
    {
      "path": "registry/blocks/organization-switcher/organization-switcher-1/organization-add-form.tsx",
      "content": "\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Controller, useForm } from \"react-hook-form\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Field,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport { toast } from \"sonner\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogClose,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { useUser } from \"@clerk/nextjs\";\nimport imageCompression from \"browser-image-compression\";\nimport {\n  CreateOrganizationParams,\n  OrganizationResource,\n  SetActiveParams,\n} from \"@clerk/types\";\nimport { updateOrganizationPicture } from \"./actions\";\nimport { Camera, Upload } from \"lucide-react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 1MB\nconst ACCEPTED_IMAGE_TYPES = [\n  \"image/jpeg\",\n  \"image/jpg\",\n  \"image/png\",\n  \"image/webp\",\n];\n\nconst organizationAddFormSchema = z.object({\n  picture: z\n    .file()\n    .min(1)\n    .max(MAX_FILE_SIZE, \"Image must be less than 8MB.\")\n    .mime(ACCEPTED_IMAGE_TYPES, \"Image must be .jpeg, .jpg, .png, or .webp.\")\n    .optional(),\n  name: z.string(),\n  slug: z.string(),\n});\n\nexport type OrganizationCreateFormValues = z.infer<\n  typeof organizationAddFormSchema\n>;\n\nexport function OrganizationCreateForm({\n  createOrganization,\n  setActive,\n  revalidate,\n  children,\n}: {\n  createOrganization: (\n    params: CreateOrganizationParams\n  ) => Promise<OrganizationResource>;\n  setActive: (params: SetActiveParams) => void;\n  revalidate: () => void;\n  children: React.ReactNode;\n}) {\n  const { user } = useUser();\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n\n  const form = useForm<z.infer<typeof organizationAddFormSchema>>({\n    resolver: zodResolver(organizationAddFormSchema),\n    defaultValues: {\n      picture: undefined,\n      name: \"\",\n      slug: \"\",\n    },\n  });\n\n  const enteredName = form.watch(\"name\");\n\n  useEffect(() => {\n    form.setValue(\n      \"name\",\n      enteredName\n        .replace(/\\s+/g, \" \") // Replace multiple spaces with a single space\n        .replace(/[:\\-\\.]{2,}/g, (match) => match[0]) // Replace multiple \":\" or \"-\" or \".\" with a single instance\n    );\n    form.setValue(\n      \"slug\",\n      enteredName.toLowerCase().replace(/[:.']/g, \"\").replace(/\\s+/g, \"-\")\n    );\n  }, [form, enteredName]);\n\n  async function handleAdd(data: OrganizationCreateFormValues) {\n    if (!user) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        const organization = await createOrganization({\n          name: data.name,\n          slug: data.slug,\n        });\n\n        if (data.picture) {\n          const compressedPicture = await imageCompression(data.picture, {\n            maxSizeMB: 1,\n            maxWidthOrHeight: 1024,\n            useWebWorker: true,\n          });\n\n          await updateOrganizationPicture(organization.id, {\n            file: compressedPicture,\n            uploaderUserId: user.id,\n          });\n        }\n\n        setActive({ organization: organization.id });\n        revalidate();\n\n        toast.success(\"Organization created successfully.\");\n        setShowAddDialog(false);\n      } catch (err) {\n        if (err instanceof Error) {\n          toast.error(err.message);\n        } else {\n          toast.error(\"An unknown error occured creating the organization.\");\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n  }\n\n  function onSubmit(data: OrganizationCreateFormValues) {\n    handleAdd(data);\n  }\n\n  return (\n    <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n      <DialogTrigger asChild>{children}</DialogTrigger>\n      <DialogContent\n        className=\"sm:max-w-[425px]\"\n        aria-describedby=\"A popup form requesting information on an organization to add.\"\n      >\n        <DialogHeader>\n          <DialogTitle>Create an organization</DialogTitle>\n        </DialogHeader>\n        <form\n          id=\"form-organization-create-1\"\n          onSubmit={form.handleSubmit(onSubmit)}\n        >\n          <FieldGroup className=\"gap-4\">\n            <Avatar className=\"aspect-square size-24 rounded-full bg-slate-400\">\n              <AvatarImage\n                src={previewUrl ?? undefined}\n                className=\"object-cover\"\n                alt=\"Organization picture\"\n              />\n              <AvatarFallback>\n                <Camera />\n              </AvatarFallback>\n            </Avatar>\n\n            <Controller\n              name=\"picture\"\n              control={form.control}\n              render={({ field: { onChange }, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    className=\"hidden\"\n                    ref={inputRef}\n                    onChange={(event) => {\n                      const file = event.target.files?.[0];\n                      if (file) {\n                        onChange(file);\n                        const objectUrl = URL.createObjectURL(file);\n                        setPreviewUrl(objectUrl);\n                      }\n                    }}\n                  />\n\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"w-full\"\n                    type=\"button\"\n                    disabled={loading}\n                    onClick={() => inputRef.current?.click()}\n                  >\n                    <span className=\"flex items-center gap-2\">\n                      <Upload />\n                      Select Image\n                    </span>\n                  </Button>\n\n                  <FieldDescription className=\"text-center sm:text-start text-xs\">\n                    Recommend size 1:1, up to 8MB\n                  </FieldDescription>\n\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n            <Controller\n              name=\"name\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-organization-create-1-name\">\n                    Name\n                  </FieldLabel>\n                  <Input\n                    {...field}\n                    id=\"form-organization-create-1-name\"\n                    aria-invalid={fieldState.invalid}\n                    placeholder=\"Acme, Inc.\"\n                    type=\"text\"\n                    autoComplete=\"organization\"\n                  />\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n            <Controller\n              name=\"slug\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-organization-create-1-name\">\n                    Slug\n                  </FieldLabel>\n                  <Input\n                    {...field}\n                    id=\"form-organization-create-1-name\"\n                    aria-invalid={fieldState.invalid}\n                    placeholder=\"acme-inc\"\n                    type=\"text\"\n                    disabled\n                  />\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n          </FieldGroup>\n        </form>\n\n        <DialogFooter>\n          <DialogClose asChild>\n            <Button variant=\"outline\">Cancel</Button>\n          </DialogClose>\n          <Button\n            type=\"submit\"\n            form=\"form-organization-create-1\"\n            disabled={loading}\n          >\n            {loading ? (\n              <>\n                <Spinner />\n                <p>Creating...</p>\n              </>\n            ) : (\n              \"Create organization\"\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/organization-switcher-1/organization-add-form.tsx"
    }
  ]
}