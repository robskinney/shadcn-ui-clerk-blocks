{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "organization-form-1",
  "type": "registry:block",
  "title": "Organization Form - 1",
  "description": "A simple organization form.",
  "dependencies": [
    "zod",
    "react-hook-form",
    "@hookform/resolvers",
    "browser-image-compression",
    "@clerk/types",
    "@clerk/nextjs"
  ],
  "registryDependencies": [
    "card",
    "input",
    "avatar",
    "skeleton",
    "button",
    "sonner",
    "field",
    "spinner",
    "input-group",
    "label"
  ],
  "files": [
    {
      "path": "registry/blocks/organization-form/organization-form-1/actions.ts",
      "content": "\"use server\";\n\nimport { auth, clerkClient } from \"@clerk/nextjs/server\";\nimport { OrganizationUpdateFormValues } from \".\";\n\nexport async function updateOrganization(data: OrganizationUpdateFormValues) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    throw new Error(\"Failed to update organization.\");\n  }\n\n  const client = await clerkClient();\n\n  await client.organizations.updateOrganization(data.id, {\n    name: data.name,\n    slug: data.slug,\n  });\n\n  if (data.picture && data.picture.size > 0) {\n    await client.organizations.updateOrganizationLogo(data.id, {\n      file: data.picture,\n      uploaderUserId: userId,\n    });\n  }\n}\n",
      "type": "registry:file",
      "target": "components/organization-form-1/actions.ts"
    },
    {
      "path": "registry/blocks/organization-form/organization-form-1/index.tsx",
      "content": "\"use client\";\n\nimport { Upload } from \"lucide-react\";\n\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport imageCompression from \"browser-image-compression\";\nimport { useAuth, useOrganization } from \"@clerk/nextjs\";\nimport { Button } from \"@/components/ui/button\";\nimport z from \"zod\";\nimport { Controller, useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { toast } from \"sonner\";\nimport {\n  Field,\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { InputGroup, InputGroupInput } from \"@/components/ui/input-group\";\nimport { Organization } from \"@clerk/backend\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { updateOrganization } from \"./actions\";\nimport { OrganizationResource } from \"@clerk/types\";\n\nexport type OrganizationForm1Props = {\n  /**\n   * A Clerk [Organization](https://clerk.com/docs/reference/javascript/organization) object retrieved from either the frontend or backend SDK.\n   **/\n  organization?: Partial<OrganizationResource> | Partial<Organization>;\n};\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 1MB\nconst ACCEPTED_IMAGE_TYPES = [\n  \"image/jpeg\",\n  \"image/jpg\",\n  \"image/png\",\n  \"image/webp\",\n];\n\nconst organizationUpdateFormSchema = z.object({\n  id: z.string(),\n  picture: z\n    .file()\n    .min(1)\n    .max(MAX_FILE_SIZE, \"Image must be less than 8MB.\")\n    .mime(ACCEPTED_IMAGE_TYPES, \"Image must be .jpeg, .jpg, .png, or .webp.\")\n    .optional(),\n  name: z.string(),\n  slug: z.string(),\n});\n\nexport type OrganizationUpdateFormValues = z.infer<\n  typeof organizationUpdateFormSchema\n>;\n\nexport default function OrganizationForm1({\n  organization: propOrganization,\n}: OrganizationForm1Props) {\n  const { isSignedIn } = useAuth();\n\n  const { organization: hookOrganization, isLoaded: hookLoaded } =\n    useOrganization();\n\n  const organization = propOrganization ?? hookOrganization;\n  const isLoaded = propOrganization ? true : hookLoaded;\n\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(\n    organization?.imageUrl ?? null\n  );\n\n  const form = useForm<z.infer<typeof organizationUpdateFormSchema>>({\n    resolver: zodResolver(organizationUpdateFormSchema),\n    defaultValues: {\n      id: organization?.id,\n      picture: undefined,\n      name: organization?.name ?? \"\",\n      slug: organization?.slug ?? \"\",\n    },\n  });\n\n  const enteredName = form.watch(\"name\");\n\n  useEffect(() => {\n    form.setValue(\n      \"name\",\n      enteredName\n        .replace(/\\s+/g, \" \") // Replace multiple spaces with a single space\n        .replace(/[:\\-\\.]{2,}/g, (match) => match[0]) // Replace multiple \":\" or \"-\" or \".\" with a single instance\n    );\n    form.setValue(\n      \"slug\",\n      enteredName.toLowerCase().replace(/[:.']/g, \"\").replace(/\\s+/g, \"-\")\n    );\n  }, [form, enteredName]);\n\n  useEffect(() => {\n    if (isLoaded && organization) {\n      form.reset({\n        id: organization?.id,\n        picture: undefined,\n        name: organization?.name ?? \"\",\n        slug: organization?.slug ?? \"\",\n      });\n      setPreviewUrl(organization.imageUrl ?? null);\n    }\n  }, [isLoaded, organization, form]);\n\n  async function handleUpdate(data: OrganizationUpdateFormValues) {\n    if (!isSignedIn) {\n      toast.warning(\"You must be logged in to use this functionality.\");\n    } else {\n      setLoading(true);\n      try {\n        const processedData = { ...data };\n\n        if (data.picture) {\n          const compressedFile = await imageCompression(data.picture, {\n            maxSizeMB: 1,\n            maxWidthOrHeight: 1024,\n            useWebWorker: true,\n          });\n\n          processedData.picture = compressedFile;\n        }\n\n        await updateOrganization(processedData);\n        toast.success(\"Organization updated successfully.\");\n      } catch (err) {\n        console.error(err);\n        toast.error(\"Failed to update organization.\");\n      } finally {\n        setLoading(false);\n      }\n    }\n  }\n\n  function onSubmit(data: OrganizationUpdateFormValues) {\n    handleUpdate(data);\n  }\n\n  return (\n    <Card className=\"w-full\">\n      <CardContent className=\"mx-auto w-full lg:max-w-4/5 xl:max-w-3/4\">\n        <form\n          id=\"form-organization-update-1\"\n          className=\"flex flex-col gap-y-8 px-3 sm:px-5 py-5\"\n          onSubmit={form.handleSubmit(onSubmit)}\n        >\n          <div className=\"flex flex-col sm:flex-row items-center gap-4\">\n            {isLoaded && organization ? (\n              <Avatar className=\"aspect-square size-24 rounded-full bg-slate-400\">\n                <AvatarImage\n                  src={previewUrl ?? organization?.imageUrl ?? undefined}\n                  className=\"object-cover\"\n                  alt=\"Organization profile picture\"\n                />\n                <AvatarFallback />\n              </Avatar>\n            ) : (\n              <Skeleton className={`size-24 rounded-full`} />\n            )}\n\n            <div>\n              <Controller\n                name=\"picture\"\n                control={form.control}\n                render={({ field: { onChange }, fieldState }) => (\n                  <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                    <input\n                      type=\"file\"\n                      accept=\"image/*\"\n                      className=\"hidden\"\n                      ref={inputRef}\n                      onChange={(event) => {\n                        const file = event.target.files?.[0];\n                        if (file) {\n                          onChange(file);\n                          const objectUrl = URL.createObjectURL(file);\n                          setPreviewUrl(objectUrl);\n                        }\n                      }}\n                    />\n\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full\"\n                      type=\"button\"\n                      disabled={!isLoaded}\n                      onClick={() => inputRef.current?.click()}\n                    >\n                      <span className=\"flex items-center gap-2\">\n                        <Upload />\n                        Replace Image\n                      </span>\n                    </Button>\n\n                    <FieldDescription className=\"text-center sm:text-start text-xs\">\n                      Recommend size 1:1, up to 8MB\n                    </FieldDescription>\n\n                    {fieldState.invalid && (\n                      <FieldError errors={[fieldState.error]} />\n                    )}\n                  </Field>\n                )}\n              />\n            </div>\n          </div>\n\n          <div className=\"flex flex-col gap-3\">\n            <Controller\n              name=\"name\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-organization-update-1-name\">\n                    Name\n                  </FieldLabel>\n                  <InputGroup>\n                    {isLoaded ? (\n                      <InputGroupInput\n                        {...field}\n                        id=\"form-organization-update-1-name\"\n                        aria-invalid={fieldState.invalid}\n                        placeholder=\"Acme, Inc.\"\n                        autoComplete=\"organization\"\n                        disabled={!isLoaded}\n                      />\n                    ) : (\n                      <Skeleton className=\"w-20 h-5 ml-1.5\" />\n                    )}\n                  </InputGroup>\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n            <Controller\n              name=\"slug\"\n              control={form.control}\n              render={({ field, fieldState }) => (\n                <Field data-invalid={fieldState.invalid} className=\"gap-1\">\n                  <FieldLabel htmlFor=\"form-organization-update-1-name\">\n                    Slug\n                  </FieldLabel>\n                  <InputGroup>\n                    {isLoaded ? (\n                      <InputGroupInput\n                        {...field}\n                        id=\"form-organization-update-1-slug\"\n                        aria-invalid={fieldState.invalid}\n                        placeholder=\"acme-inc\"\n                        disabled\n                      />\n                    ) : (\n                      <Skeleton className=\"w-20 h-5 ml-1.5\" />\n                    )}\n                  </InputGroup>\n                  {fieldState.invalid && (\n                    <FieldError errors={[fieldState.error]} />\n                  )}\n                </Field>\n              )}\n            />\n          </div>\n\n          <Button type=\"submit\" disabled={loading}>\n            {loading ? (\n              <>\n                <Spinner />\n                <p>Saving...</p>\n              </>\n            ) : (\n              \"Save Changes\"\n            )}\n          </Button>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/organization-form-1/index.tsx"
    },
    {
      "path": "registry/lib/format-organization.ts",
      "content": "import { Organization } from \"@clerk/backend\";\nimport { OrganizationResource } from \"@clerk/types\";\n\nexport function formatOrganization(\n  organization: Partial<Organization> | Partial<OrganizationResource>\n) {\n  return {\n    imageUrl: organization.imageUrl,\n    name: organization.name,\n    slug: organization.slug,\n  };\n}\n",
      "type": "registry:lib"
    }
  ]
}